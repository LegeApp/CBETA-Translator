<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ae="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             x:Class="CbetaTranslator.App.Views.TranslationTabView">

	<!-- LOCAL FALLBACK RESOURCES (prevents "blank view" when app theme keys are missing) -->
	<UserControl.Resources>
		<!-- Panel colors -->
		<SolidColorBrush x:Key="PanelBg" Color="#FFF5F5F5"/>
		<SolidColorBrush x:Key="PanelAltBg" Color="#FFFFFFFF"/>
		<SolidColorBrush x:Key="PanelBorder" Color="#FFE8E8E8"/>
		<SolidColorBrush x:Key="SplitterBrush" Color="#FFD1D1D1"/>

		<!-- Muted text -->
		<SolidColorBrush x:Key="MutedFg" Color="#FF666666"/>
	</UserControl.Resources>

	<UserControl.Styles>
		<!-- Keep Fluent theme for AvaloniaEdit -->
		<StyleInclude Source="avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml" />

		<!-- Muted class (fallback) -->
		<Style Selector="TextBlock.muted">
			<Setter Property="Foreground" Value="{DynamicResource MutedFg}"/>
		</Style>

		<!-- Hard override so text is visible in both light and dark UI -->
		<Style Selector="ae|TextEditor">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{DynamicResource TextFg}"/>
		</Style>
	</UserControl.Styles>

	<Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="1*,Auto,1*">

		<!-- Button bar -->
		<Border Grid.Row="0"
				Grid.ColumnSpan="3"
				Background="{DynamicResource PanelAltBg}"
				Padding="8"
				CornerRadius="6">
			<DockPanel LastChildFill="True">

				<!-- Left cluster -->
				<StackPanel DockPanel.Dock="Left"
							Orientation="Horizontal"
							Spacing="6">
					<Button Name="BtnCopyPrompt" Focusable="False" Content="Copy selection + prompt"/>
					<Button Name="BtnPasteReplace" Focusable="False" Content="Paste replace selection"/>
					<Button Name="BtnSaveTranslated" Focusable="False" Content="Save Markdown"/>
					<Button Name="BtnRevertMarkdown" Focusable="False" Content="Revert Markdown"/>
					<Button Name="BtnExportPdf" Focusable="False" Content="Export PDF"/>
				</StackPanel>

				<!-- spacer (fills the middle) -->
				<Border/>

				<!-- Right cluster -->
				<StackPanel DockPanel.Dock="Right"
							Orientation="Horizontal"
							Spacing="8"
							VerticalAlignment="Center"
							Margin="18,0,0,0">
					<CheckBox Name="ChkWrap"
							  VerticalAlignment="Center"
							  Content="Wrap"/>
				</StackPanel>

			</DockPanel>
		</Border>


		<!-- Find bar -->
		<Border Name="FindBar"
				Grid.Row="1"
				Grid.ColumnSpan="3"
				Background="{DynamicResource PanelAltBg}"
				Padding="8"
				CornerRadius="8"
				Margin="0,8,0,0"
				IsVisible="False">
			<DockPanel LastChildFill="True">

				<TextBlock Name="FindScope"
						   DockPanel.Dock="Left"
						   Classes="muted"
						   VerticalAlignment="Center"
						   Margin="0,0,10,0"
						   Text="Find:"/>

				<TextBox Name="FindQuery"
						 Watermark="Find…"
						 MinWidth="260"
						 VerticalAlignment="Center"/>

				<StackPanel DockPanel.Dock="Right"
							Orientation="Horizontal"
							Spacing="8"
							Margin="10,0,0,0">
					<TextBlock Name="FindCount"
							   Classes="muted"
							   VerticalAlignment="Center"
							   Text="0/0"/>

					<Button Name="BtnPrev"
							Focusable="False"
							Content="Prev"/>

					<Button Name="BtnNext"
							Focusable="False"
							Content="Next"/>

					<Button Name="BtnCloseFind"
							Focusable="False"
							Content="✕"/>
				</StackPanel>

			</DockPanel>
		</Border>

		<!-- Left: Original -->
		<Border Grid.Row="2"
				Grid.Column="0"
				Margin="0,8,6,0"
				Background="{DynamicResource XmlViewerBg}"
				BorderBrush="{DynamicResource XmlViewerBorder}"
				BorderThickness="1"
				CornerRadius="6">
			<Grid RowDefinitions="Auto,*">
				<Border Background="{DynamicResource XmlViewerBg}"
						Padding="8">
					<TextBlock Text="Original XML (read-only)"
							   Classes="muted"/>
				</Border>

				<ae:TextEditor Name="EditorOrigXml"
							   Grid.Row="1"
							   IsReadOnly="True"
							   FontFamily="Consolas"
							   Foreground="#FF111111"
							   Background="Transparent"
							   ShowLineNumbers="False"
							   WordWrap="False"/>
			</Grid>
		</Border>

		<!-- Splitter -->
		<GridSplitter Grid.Row="2"
					  Grid.Column="1"
					  Width="6"
					  Background="{DynamicResource SplitterBrush}"
					  Margin="0,8,0,0"/>

		<!-- Right: Translated -->
		<Border Grid.Row="2"
				Grid.Column="2"
				Margin="6,8,0,0"
				Background="{DynamicResource XmlViewerBg}"
				BorderBrush="{DynamicResource XmlViewerBorder}"
				BorderThickness="1"
				CornerRadius="6">
			<Grid RowDefinitions="Auto,*">
				<Border Background="{DynamicResource XmlViewerBg}"
						Padding="8">
					<TextBlock Text="Editable Markdown"
							   Classes="muted"/>
				</Border>

				<ae:TextEditor Name="EditorTranXml"
							   Grid.Row="1"
							   IsReadOnly="False"
							   FontFamily="Consolas"
							   Foreground="{DynamicResource TextFg}"
							   Background="Transparent"
							   ShowLineNumbers="False"
							   WordWrap="False"/>
			</Grid>
		</Border>

	</Grid>
</UserControl>
